# Telegram Bot - English Words Trainer

Telegram бот для изучения английских слов с системой интервального повторения и отслеживанием прогресса.

## Назначение проекта

Бот помогает изучать английские слова через интерактивные квизы. Пользователь видит русское слово и выбирает правильный английский перевод из 4 вариантов. Система отслеживает прогресс: 5 правильных ответов подряд означает, что слово выучено.

### Основные возможности

- Изучение слов через квиз-формат (выбор из 4 вариантов)
- Словарь Мюллера (~1500 пар слов в базе)
- Добавление собственных слов для изучения
- Система избранного для приоритетных слов
- Отслеживание прогресса и статистики
- Автоматический сброс прогресса после 5 дней неактивности

---

## Структура проекта

```
tgm_translate/
├── app/                        # Точка входа приложения
│   ├── __init__.py
│   └── main.py                 # Запуск бота
│
├── bot/                        # Логика Telegram бота
│   ├── __init__.py
│   ├── bot_instance.py         # Экземпляр бота и управление состояниями
│   │
│   ├── handlers/               # Обработчики команд и сообщений
│   │   ├── __init__.py
│   │   ├── start.py            # /start, /help, /menu
│   │   ├── learning.py         # Режим обучения (квиз)
│   │   ├── words.py            # Добавление пользовательских слов
│   │   ├── favorites.py        # Управление избранным
│   │   └── stats.py            # Просмотр статистики
│   │
│   ├── keyboards/              # Клавиатуры бота
│   │   ├── __init__.py
│   │   ├── main_menu.py        # Главное меню
│   │   └── learning_kb.py      # Клавиатуры режима обучения
│   │
│   └── states/                 # Состояния пользователя
│       ├── __init__.py
│       └── learning_states.py  # Константы состояний и кнопок
│
├── config/                     # Конфигурация
│   ├── __init__.py
│   └── settings.py             # Настройки приложения
│
├── sql_db/                     # База данных
│   ├── __init__.py
│   ├── db_init.py              # Подключение к PostgreSQL
│   ├── models.py               # SQLAlchemy модели
│   ├── create_db.py            # Инициализация БД из словаря
│   │
│   └── sql_requests/           # SQL запросы
│       ├── __init__.py
│       ├── users.py            # Операции с пользователями
│       ├── words.py            # Операции со словами
│       └── learning.py         # Логика обучения и прогресса
│
├── data_words/                 # Словарные данные
│   ├── mueller_dictionary.csv  # Словарь Мюллера (CSV)
│   ├── mueller-base.txt        # Исходный файл словаря
│   └── words_pairs_parser.py   # Парсер словаря
│
├── .env                        # Переменные окружения (не в git)
├── .gitignore
├── requirements.txt            # Зависимости Python
└── venv/                       # Виртуальное окружение
```

---

## Описание файлов

### Точка входа (`app/`)

| Файл | Описание |
|------|----------|
| `main.py` | Главный файл запуска бота. Импортирует все handlers, проверяет токен и запускает polling |

### Бот (`bot/`)

| Файл | Описание |
|------|----------|
| `bot_instance.py` | Создает экземпляр `TeleBot`, управляет состояниями пользователей в памяти |
| `handlers/start.py` | Обработка `/start`, `/help`, `/menu` и кнопки "Назад" |
| `handlers/learning.py` | Режим обучения: показ вопросов, обработка ответов, подсчет результатов |
| `handlers/words.py` | Добавление пользовательских слов (английское + русский перевод) |
| `handlers/favorites.py` | Просмотр и удаление избранных слов |
| `handlers/stats.py` | Отображение статистики пользователя |
| `keyboards/main_menu.py` | Reply-клавиатуры главного меню |
| `keyboards/learning_kb.py` | Inline-клавиатуры для квиза и карточек слов |
| `states/learning_states.py` | Константы состояний (`States`), текстов кнопок (`MenuButtons`), callback-данных |

### Конфигурация (`config/`)

| Файл | Описание |
|------|----------|
| `settings.py` | Класс `Settings` с настройками: токен бота, параметры PostgreSQL, настройки обучения |

### База данных (`sql_db/`)

| Файл | Описание |
|------|----------|
| `db_init.py` | Подключение к PostgreSQL через SQLAlchemy, контекстный менеджер сессий |
| `models.py` | ORM-модели: `User`, `WordEn`, `WordRu`, `Translate`, `UserFavorite`, `UserTranslationProgress`, `UserAttempt` |
| `create_db.py` | Скрипт инициализации БД: создает таблицы и загружает словарь из CSV |
| `sql_requests/users.py` | CRUD операции с пользователями |
| `sql_requests/words.py` | Операции со словами: добавление, поиск, избранное |
| `sql_requests/learning.py` | Логика обучения: выборка слов, запись попыток, прогресс, статистика |

### Словарь (`data_words/`)

| Файл | Описание |
|------|----------|
| `mueller_dictionary.csv` | Словарь Мюллера в CSV (11.7 МБ, ~150 000 записей) |
| `mueller-base.txt` | Исходный текстовый файл словаря |
| `words_pairs_parser.py` | Скрипт парсинга словаря в CSV формат |

### Корневые файлы

| Файл | Описание |
|------|----------|
| `.env` | Переменные окружения (TELEGRAM_TOKEN, параметры PostgreSQL) |
| `requirements.txt` | Python зависимости |
| `.gitignore` | Исключения для git |

---

## Установка и запуск

### 1. Клонирование и настройка окружения

```bash
git clone <repository-url>
cd tgm_translate
python -m venv venv
venv\Scripts\activate  # Windows
# или source venv/bin/activate  # Linux/Mac
pip install -r requirements.txt
```

### 2. Настройка переменных окружения

Создайте файл `.env` в корне проекта:

```env
TELEGRAM_TOKEN=ваш_токен_бота

POSTGRES_HOST=localhost
POSTGRES_PORT=5432
POSTGRES_DB=appdb
POSTGRES_USER=postgres
POSTGRES_PASSWORD=ваш_пароль
```

### 3. Инициализация базы данных

```bash
python sql_db/create_db.py
```

Скрипт создаст таблицы и загрузит ~1500 пар слов из словаря Мюллера.

### 4. Запуск бота

```bash
python app/main.py
```

---

## Инструкция для пользователей бота

### Начало работы

1. Найдите бота в Telegram и нажмите **Start** или отправьте команду `/start`
2. Бот автоматически зарегистрирует вас и покажет главное меню

### Главное меню

После запуска вы увидите 4 кнопки:

| Кнопка | Действие |
|--------|----------|
| **Учить слова** | Начать сессию изучения (20 слов) |
| **Добавить слово** | Добавить своё слово для изучения |
| **Избранное** | Просмотреть и управлять своими словами |
| **Статистика** | Посмотреть свой прогресс |

### Режим обучения

1. Нажмите **"Учить слова"**
2. Бот покажет русское слово и 4 варианта перевода на английском
3. Выберите правильный вариант
4. После ответа вы увидите:
   - Правильно или нет
   - Текущую серию правильных ответов (0-5)
   - Транскрипцию слова
5. Нажмите **"Дальше"** для следующего слова
6. После 20 слов сессия завершится с итогами

**Система прогресса:**
- 5 правильных ответов подряд = слово выучено
- Неправильный ответ сбрасывает серию
- Если не заходить 5 дней — прогресс невыученных слов сбрасывается

### Добавление своих слов

1. Нажмите **"Добавить слово"**
2. Введите английское слово (до 40 символов)
3. Введите русский перевод (до 250 символов)
4. Слово добавится в ваш список и будет появляться в обучении

**Важно:** Если слово уже есть в словаре, оно добавится в избранное вместо создания дубликата.

### Избранное

В избранном хранятся:
- Ваши личные слова (отмечены как "ваши")
- Слова из общего словаря, которые вы добавили в избранное

Во время обучения можно нажать **"В избранное"** чтобы добавить понравившееся слово.

Из избранного слово можно удалить кнопкой **"Удалить"**.

### Статистика

Показывает:
- Количество выученных слов
- Слова в процессе изучения
- Всего попыток и точность
- Количество личных слов и избранных

### Доступные команды

| Команда | Описание |
|---------|----------|
| `/start` | Начать работу с ботом / вернуться в начало |
| `/help` | Справка по использованию |
| `/menu` | Вернуться в главное меню |
| `/stats` | Посмотреть статистику |

### Приоритет слов в обучении

Слова для сессии выбираются в таком порядке:
1. Ваши личные слова (которые вы добавили сами)
2. Слова из избранного
3. Случайные слова из общего словаря

Выученные слова (5 правильных ответов) исключаются из обучения.

---

## Схема базы данных

```
┌──────────────┐       ┌──────────────┐       ┌──────────────┐
│   user_tg    │       │   word_en    │       │   word_ru    │
├──────────────┤       ├──────────────┤       ├──────────────┤
│ id (PK)      │       │ id (PK)      │       │ id (PK)      │
│ nickname     │       │ word         │       │ word         │
└──────┬───────┘       │ transcription│       └──────┬───────┘
       │               └──────┬───────┘              │
       │                      │                      │
       │               ┌──────┴──────────────────────┴───┐
       │               │          translate               │
       │               ├──────────────────────────────────┤
       ├───────────────│ id (PK)                          │
       │               │ word_e (FK → word_en)            │
       │               │ word_r (FK → word_ru)            │
       │               │ owner_user (FK → user_tg | NULL) │
       │               └──────────────┬───────────────────┘
       │                              │
       │    ┌─────────────────────────┼─────────────────────────┐
       │    │                         │                         │
┌──────┴────┴────┐        ┌───────────┴────────┐      ┌─────────┴────────┐
│ user_favorite  │        │user_translation_   │      │  user_attempts   │
├────────────────┤        │    progress        │      ├──────────────────┤
│ id (PK)        │        ├────────────────────┤      │ id (PK)          │
│ user_id (FK)   │        │ id (PK)            │      │ user_id (FK)     │
│ translate_id   │        │ user_id (FK)       │      │ translate_id (FK)│
│    (FK)        │        │ translate_id (FK)  │      │ is_correct       │
└────────────────┘        │ correct_streak     │      │ attempted_at     │
                          │ is_memorized       │      └──────────────────┘
                          │ last_attempt_at    │
                          └────────────────────┘
```

---

## Технологии

- **Python 3.10+**
- **pyTelegramBotAPI 4.25** — Telegram Bot API
- **SQLAlchemy 2.0** — ORM для работы с БД
- **PostgreSQL** — база данных
- **psycopg2** — драйвер PostgreSQL
- **python-dotenv** — управление переменными окружения

---

## Настройки обучения

В файле `config/settings.py`:

```python
WORDS_PER_SESSION = 20    # Слов в одной сессии
STREAK_TO_MEMORIZE = 5    # Правильных ответов для запоминания
RESET_DAYS = 5            # Дней неактивности для сброса прогресса
```
